<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Lesson 6 Homework</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
    <style>
      h1 {
        text-align: center;
      }
      #chessBoard {
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
      }
      div {
        box-sizing: border-box;
        border: 1px solid black;
        text-align: center;
        font-size: 32px;
      }
      .chessBoardCell {
        width: 100px;
        height: 100px;
        line-height: 100px;
      }
      .rotate {
        transform: rotate(180deg);
      }
      .black {
        background-color: saddleBrown ;
      }
      .beige {
        background-color: beige;
      }

      #chessBoardControls {
        width: 1002px;
        margin: 10px auto 0;
        display: flex;
        justify-content: center;
      }
      #generateChessBoard {
        height: 80px;
        width: 200px;
        font-size: inherit;
      }

      #basket {
        width: 1002px;
        margin: 0 auto;
      }
      ol {
        text-align: left;
      }

      #basketControls {
        width: 1002px;
        margin: 10px auto 0;
        text-align: inherit;
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
      }
      #clearBasket {
        height: 80px;
        width: 200px;
        font-size: inherit;
        margin: 10px;
      }
      #addItem {
        height: 80px;
        width: 200px;
        font-size: inherit;
      }
      form {
        margin: 10px;
        text-align: center;
        display: flex;
      }
      label {
        display: flex;
        flex-direction: column;
      }
      input {
        margin: 10px 10px 0 0;
      }
      select {
        font-size: inherit;
        height: 50px;
      }
      span {
        margin: 0 50px;
      }
      #changeQuantity {
        height: 80px;
        width: 200px;
        font-size: inherit;
        margin-left: 50px;
      }
      #removeItem {
        height: 80px;
        width: 200px;
        font-size: inherit;
        margin-left: 50px;
      }
      .modalWrapper {
        display: none;
        position: fixed;
        z-index: 1;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgb(0,0,0);
        background-color: rgba(0,0,0,0.4);
        border: none;
      }
      .modalWindow {
        position: absolute;
        top: 20%;
        left: 0;
        right: 0;
        margin: 0 auto;
        width: 250px;
        height: 200px;
        border: none;
      }
      .close {
        color: #000;
        float: right;
        margin: 0;
        cursor: pointer;
        line-height: 15px;
      }
      #modalArrowLeft {
        position: absolute;
        top: 45%;
        left: 0;
      }
      #modalArrowRight {
        position: absolute;
        top: 45%;
        right: 0;
      }

      #dungeonCrawler {
        width: 1002px;
        margin: 10px auto 0;
        position: relative;
      }
      #mapContainer {
        width: 302px;
        margin: 0 auto 50px;
        display: flex;
        flex-wrap: wrap;
      }
      .mapCell {
        width: 100px;
        height: 100px;
      }
      .unexplored {
        background-color: darkgray;
        filter: blur(1px);
      }
      .room {
        background-image: url('http://www.dungeoncreatorsets.com/rpg-dungeons-tiles/dungeon-tile_02_middle_001.jpg');
        background-size: cover;
      }
      .wall {
        background-image: url('http://www.tomgrill.com/brickwall/perfect_test.jpg');
      }
      .player {
        height: 50px;
      }
      #playerStatsDiv {
        position: absolute;
        top: 0;
        left: 0;
        margin: 10% 0 0 5%;
        width: 250px;
        height: 304px;
      }
      .potion {
        height: 100px;
        display: none;
      }
      #skeletonStatsDiv {
        position: absolute;
        top: 0;
        right: 0;
        margin: 10% 5% 0 0;
        width: 250px;
        height: 200px;
      }

      #dungeonCrawlerControls {
        margin: 10px auto 0;
        width: 1002px;
        height: 110px;
      }
      #controlsDiv {
        width: 450px;
        height: 90px;
        margin: 10px 0 0 10px;
        display: inline-flex;
        justify-content: center;
        align-items: center;
      }
      .moveArrow {
        width: 100px;
        height: 50px;
        font-size: 28px;
      }
      #messageDiv {
        margin: 10px 10px 10px 10px;
        float: right;
        font-size: 24px;
        width: 500px;
        height: 90px;
      }

      #ticTacToe {
        width: 302px;
        margin: 10px auto 0;
        display: flex;
        flex-wrap: wrap;
        border: none;
        position: relative;
      }
      .gridCell {
        width: 100px;
        height: 100px;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 48px;
      }
      #clearButton {
        position: absolute;
        top: 37%;
        left: -80%;
        height: 80px;
        width: 200px;
        font-size: inherit;
      }
      #playerTurnDiv {
        position: absolute;
        top: 37%;
        right: -110%;
        height: 80px;
        width: 300px;
        font-size: inherit;
        line-height: 80px;
      }

      .show {
        display: block;
      }
      .hide {
        display: none;
      }
    </style>
    <script>
      function wrapperFunc() {
        // Exercises 1 & 2
        class Product {
          constructor(name, price, quantity) {
            this.name = name;
            this.price = price;
            this.quantity = quantity;
          }
        }

        const basket = {
          currency: 'usd',
          items: [
            {name: 'Product 1', price: 500, quantity: 1, curSelectPicture: 0, pictures: [
              'https://upload.wikimedia.org/wikipedia/commons/d/d5/1-PA250210%2C_The_old_temple_has_taken_over_by_the_new_one.JPG',
              'https://upload.wikimedia.org/wikipedia/commons/4/4f/1-PA250215%2C_The_new_temple.JPG',
              'https://upload.wikimedia.org/wikipedia/commons/0/05/1-PA250222_At_Sarakki%2C.JPG',
            ]},
            {name: 'Product 2', price: 200, quantity: 2, curSelectPicture: 0, pictures: [
              'https://upload.wikimedia.org/wikipedia/commons/7/72/1000BlueBull.jpg',
              'https://upload.wikimedia.org/wikipedia/commons/6/62/102Cervus.jpg',
              'https://upload.wikimedia.org/wikipedia/commons/f/f0/10BlackBuck.jpg',
            ]},
            {name: 'Product 3', price: 100, quantity: 3, curSelectPicture: 0, pictures: [
              'https://upload.wikimedia.org/wikipedia/commons/9/94/48841893.jpg',
              'https://upload.wikimedia.org/wikipedia/commons/4/43/48974389.jpg',
              'https://upload.wikimedia.org/wikipedia/commons/d/d9/49016356.jpg',
            ]},
          ],

          countBasketPrice() {
            let sum = this.items.reduce((acc, cur) => {
              return acc + cur.price * cur.quantity;
            }, 0);
            return sum;
          },

          constBasketItems() {
            let sum = this.items.reduce((acc, cur) => {
              return acc + cur.quantity;
            }, 0);
            return sum;
          },

          clearBasket(event) {
            basket.items = [];
            basket.displayItems();
            basket.redrawSelects()
          },

          addItemToBasket(event) {
            event.preventDefault();
            const name = document.getElementById('addItemNameInput').value;
            const price = +document.getElementById('addItemPriceInput').value;
            const quantity = +document.getElementById('addItemQuantityInput').value;
            basket.items.push(new Product(name, price, quantity));
            basket.displayItems();
            basket.redrawSelects();
          },

          removeItemFromBasket(event) {
            event.preventDefault();
            const selectValue = document.getElementById('removeItemSelect').value;
            for (var i = 0; i < basket.items.length; i++) {
              if (basket.items[i].name == selectValue) {
                basket.items.splice(i, 1);
              }
            }

            basket.displayItems();
            basket.redrawSelects();
          },

          displayItems() {
            const $basket = document.getElementById('basket');
            $basket.innerHTML = '';
            const totalItems = this.constBasketItems();

            if (totalItems === 0) {
              const totalText = 'The basket is empty';
              const $totalElem = document.createElement('p');
              $totalElem.innerHTML = totalText;
              $basket.appendChild($totalElem);
            } else {
              const totalText = `There ${totalItems === 1 ? 'is' : 'are'} ${totalItems} ${totalItems === 1 ? 'item' : 'items'} in the basket with total price of ${this.countBasketPrice()} ${this.currency.toUpperCase()}`;
              const $totalElem = document.createElement('p');
              $totalElem.innerHTML = totalText;

              $basket.appendChild($totalElem);

              const $itemList = document.createElement('ol');
              $basket.appendChild($itemList);
              for (var i = 0; i < this.items.length; i++) {
                const liText = `There ${this.items[i].quantity === 1 ? 'is' : 'are'} ${this.items[i].quantity} ${this.items[i].quantity === 1 ? 'item' : 'items'} of '${this.items[i].name}' (price: ${this.items[i].price}) (<a href='#'>pictures</a>)`;
                const $liItem = document.createElement('li');
                $liItem.innerHTML = liText;
                $itemList.appendChild($liItem);
              }

              const $linksArr = $itemList.getElementsByTagName('a');
              for (var i = 0; i < $linksArr.length; i++) {
                $linksArr[i].setAttribute('id', 'pictureAnchor_' + [i]);
                $linksArr[i].addEventListener('click', this.openModalWindow);
              }
            }
          },

          changeQuantity(event) {
            event.preventDefault();
            const selectValue = document.getElementById('changeQuantitySelect').value;
            const inputValue = +document.getElementById('changeQuantityInput').value;

            for (var i = 0; i < basket.items.length; i++) {
              if (basket.items[i].name == selectValue) {
                if (inputValue == 0) {
                  basket.items.splice(i, 1);
                } else {
                  basket.items[i].quantity = inputValue;
                }
              }
            }

            basket.displayItems();
            basket.redrawSelects();
          },

          handleSelectChange(event) {
            const selectValue = document.getElementById('changeQuantitySelect').value;
            const $changeQuantitySpan = document.getElementById('changeQuantitySpan');
            for (var i = 0; i < basket.items.length; i++) {
              if (basket.items[i].name == selectValue) {
                $changeQuantitySpan.innerHTML = `Quantity: ${basket.items[i].quantity}`;
              }
            }
          },

          redrawSelects() {
            const $changeQuantitySelect = document.getElementById('changeQuantitySelect');
            $changeQuantitySelect.innerHTML = '';
            for (var i = 0; i < this.items.length; i++) {
              const $changeQuantityOption = document.createElement('option');
              $changeQuantityOption.innerHTML = this.items[i].name;
              $changeQuantitySelect.appendChild($changeQuantityOption);
            }

            const $removeItemSelect = document.getElementById('removeItemSelect');
            $removeItemSelect.innerHTML = '';
            for (var i = 0; i < this.items.length; i++) {
              const $removeItemOption = document.createElement('option');
              $removeItemOption.innerHTML = this.items[i].name;
              $removeItemSelect.appendChild($removeItemOption);
            }
          },

          displayControls() {
            const $basketControls = document.getElementById('basketControls');

            // Добавляем кнопку "очистить корзину"
            const $clearBasketButton = document.createElement('button');
            $clearBasketButton.innerHTML = 'Clear Basket';
            $clearBasketButton.setAttribute('id', 'clearBasket');
            $clearBasketButton.addEventListener('click', this.clearBasket);
            $basketControls.appendChild($clearBasketButton);

            // Добавляем форму для добавления товара в корзину
            const $addItemForm = document.createElement('form');
            $basketControls.appendChild($addItemForm);

            const $addItemNameLabel = document.createElement('label');
            $addItemNameLabel.innerHTML = 'Name';
            $addItemForm.appendChild($addItemNameLabel);
            const $addItemNameInput = document.createElement('input');
            $addItemNameInput.setAttribute('id', 'addItemNameInput');
            $addItemNameLabel.appendChild($addItemNameInput);

            const $addItemPriceLabel = document.createElement('label');
            $addItemPriceLabel.innerHTML = 'Price';
            $addItemForm.appendChild($addItemPriceLabel);
            const $addItemPriceInput = document.createElement('input');
            $addItemPriceInput.setAttribute('id', 'addItemPriceInput');
            $addItemPriceInput.setAttribute('type', 'number');
            $addItemPriceLabel.appendChild($addItemPriceInput);

            const $addItemQuantityLabel = document.createElement('label');
            $addItemQuantityLabel.innerHTML = 'Quantity';
            $addItemForm.appendChild($addItemQuantityLabel);
            const $addItemQuantityInput = document.createElement('input');
            $addItemQuantityInput.setAttribute('id', 'addItemQuantityInput');
            $addItemQuantityInput.setAttribute('type', 'number');
            $addItemQuantityLabel.appendChild($addItemQuantityInput);

            const $addItemButton = document.createElement('button');
            $addItemButton.innerHTML = 'Add item';
            $addItemButton.setAttribute('id', 'addItem');
            $addItemButton.addEventListener('click', this.addItemToBasket);
            $addItemForm.appendChild($addItemButton);

            // Добавляем форму для изменения количества товара
            const $changeQuantityForm = document.createElement('form');
            $basketControls.appendChild($changeQuantityForm);

            const $changeQuantitySelect = document.createElement('select');
            $changeQuantitySelect.setAttribute('id', 'changeQuantitySelect');
            $changeQuantitySelect.addEventListener('change', this.handleSelectChange);
            $changeQuantityForm.appendChild($changeQuantitySelect);
            for (var i = 0; i < this.items.length; i++) {
              const $changeQuantityOption = document.createElement('option');
              $changeQuantityOption.innerHTML = this.items[i].name;
              $changeQuantitySelect.appendChild($changeQuantityOption);
            }

            const $changeQuantitySpan = document.createElement('span');
            $changeQuantitySpan.setAttribute('id', 'changeQuantitySpan');
            const curSelectText = $changeQuantitySelect.options[$changeQuantitySelect.selectedIndex].text;
            for (var i = 0; i < this.items.length; i++) {
              if (this.items[i].name == curSelectText) {
                $changeQuantitySpan.innerHTML = `Quantity: ${this.items[i].quantity}`;
              }
            }
            $changeQuantityForm.appendChild($changeQuantitySpan);

            const $changeQuantityLabel = document.createElement('label');
            $changeQuantityLabel.innerHTML = 'New Quantity';
            $changeQuantityForm.appendChild($changeQuantityLabel);
            const $changeQuantityInput = document.createElement('input');
            $changeQuantityInput.setAttribute('id', 'changeQuantityInput');
            $changeQuantityInput.setAttribute('type', 'number');
            $changeQuantityLabel.appendChild($changeQuantityInput);

            const $changeQuantityButton = document.createElement('button');
            $changeQuantityButton.innerHTML = 'Change Quantity';
            $changeQuantityButton.setAttribute('id', 'changeQuantity');
            $changeQuantityButton.addEventListener('click', this.changeQuantity);
            $changeQuantityButton.addEventListener('click', this.handleSelectChange);
            $changeQuantityForm.appendChild($changeQuantityButton);

            // Добавляем форму для удаления товара
            const $removeItemForm = document.createElement('form');
            $basketControls.appendChild($removeItemForm);

            const $removeItemSelect = document.createElement('select');
            $removeItemSelect.setAttribute('id', 'removeItemSelect');
            $removeItemForm.appendChild($removeItemSelect);
            for (var i = 0; i < this.items.length; i++) {
              const $removeItemOption = document.createElement('option');
              $removeItemOption.innerHTML = this.items[i].name;
              $removeItemSelect.appendChild($removeItemOption);
            }

            const $removeItemButton = document.createElement('button');
            $removeItemButton.innerHTML = 'Remove Item';
            $removeItemButton.setAttribute('id', 'removeItem');
            $removeItemButton.addEventListener('click', this.removeItemFromBasket);
            $removeItemForm.appendChild($removeItemButton);
          },

          prepareModal() {
            const $closeSpan = document.getElementsByClassName('close')[0];
            const $leftArrow = document.getElementById('modalArrowLeft');
            const $rigthArrow = document.getElementById('modalArrowRight');
            $closeSpan.addEventListener('click', this.closeModal);
            window.addEventListener('click', this.closeModalAnywhere);
            $leftArrow.addEventListener('click', this.switchPictures);
            $rigthArrow.addEventListener('click', this.switchPictures);
          },

          openModalWindow(event) {
            event.preventDefault();
            const $modalWrapper = document.getElementsByClassName('modalWrapper')[0];
            const $modalWindow = document.getElementsByClassName('modalWindow')[0];
            $modalWrapper.classList.remove('hide');
            $modalWrapper.classList.add('show');

            const idParts = event.target.id.split('_');
            $modalWindow.style.backgroundImage = `url(${basket.items[idParts[1]].pictures[0]})`;
            $modalWindow.setAttribute('id', `pictureOfProduct_${idParts[1]}`);
          },

          closeModal(event) {
            const $modalWrapper = document.getElementsByClassName('modalWrapper')[0];
            $modalWrapper.classList.remove('show');
            $modalWrapper.classList.add('hide');
          },

          closeModalAnywhere(event) {
            const $modalWrapper = document.getElementsByClassName('modalWrapper')[0];
            const $modalWindow = document.getElementsByClassName('modalWindow')[0];
            if ((event.target.tagName != 'A') && (event.target.tagName != 'I') && (event.target != $modalWindow)) {
              $modalWrapper.classList.remove('show');
              $modalWrapper.classList.add('hide');
            }
          },

          switchPictures(event) {
            const $modalWindow = event.target.parentElement;
            const idParts = $modalWindow.id.split('_');

            if (basket.items[idParts[1]].curSelectPicture < 2) {
              basket.items[idParts[1]].curSelectPicture++;

            } else {
              basket.items[idParts[1]].curSelectPicture = 0;
            }

            const curSelectPicture = basket.items[idParts[1]].curSelectPicture;
            $modalWindow.style.backgroundImage = `url(${basket.items[idParts[1]].pictures[curSelectPicture]})`;
          },
        }

        basket.displayItems();
        basket.displayControls();
        basket.prepareModal();

        // Exercise 01
        const dungeonCrawlerGame = {
          map: [
            [
              {type: 'room', explored: true, content: null},
              {type: 'room', explored: false, content: null},
              {type: 'room', explored: false, content: 'chest'},
            ],
            [
              {type: 'wall', explored: false, content: null},
              {type: 'room', explored: false, content: null},
              {type: 'wall', explored: false, content: null},
            ],
            [
              {type: 'room', explored: false, content: 'chest'},
              {type: 'room', explored: false, content: null},
              {type: 'room', explored: false, content: 'skeleton'},
            ]
          ],
          player: {
            position: {x: 0, y: 0},
            hasPotion: false,
            attack: 1,
            hp: 10,
            choseToRun: false,
            hasWon: false
          },
          chestConentArr: ['potion', 'sword'],
          skeleton: {
            hp: 10,
            attack: 2
          },

          drawMap() {
            const $dungeonCrawler = document.getElementById('dungeonCrawler');
            $dungeonCrawler.innerHTML = '';

            const $mapText = document.createElement('p');
            $mapText.innerHTML = 'Map of the area';
            $dungeonCrawler.appendChild($mapText);

            const $mapContainer = document.createElement('div');
            $mapContainer.setAttribute('id', 'mapContainer');
            $dungeonCrawler.appendChild($mapContainer);

            for (var i = 0; i < this.map.length; i++) {
              for (var j = 0; j < this.map[i].length; j++) {
                const $mapCell = document.createElement('div');
                $mapCell.classList.add('mapCell');
                if (!this.map[i][j].explored) {
                  $mapCell.classList.add('unexplored');
                } else {
                  switch (this.map[i][j].type) {
                    case 'room':
                      $mapCell.classList.add('room');
                      break;
                    case 'wall':
                      $mapCell.classList.add('wall');
                      break;
                  }
                }
                $mapContainer.appendChild($mapCell);
                if (i === y && j === x) {
                  const $playerImg = document.createElement('img');
                  $playerImg.src = 'http://pixelartmaker.com/art/4fe55c1d90ee939.png';
                  $playerImg.classList.add('player');
                  $mapCell.appendChild($playerImg);
                }
              }
            }

            const $playerStatsDiv = document.createElement('div');
            $playerStatsDiv.setAttribute('id', 'playerStatsDiv');
            $dungeonCrawler.appendChild($playerStatsDiv);
            const $hp = document.createElement('p');
            $hp.innerHTML = `Your HP: ${this.player.hp}/10`;
            $playerStatsDiv.appendChild($hp);
            const $attack = document.createElement('p');
            $attack.innerHTML = `Your attack: ${this.player.attack}`;
            $playerStatsDiv.appendChild($attack);
            const $potion = document.createElement('img');
            $potion.classList.add('potion');
            if (this.player.hasPotion) {
              $potion.classList.add('show');
            }
            $potion.src = 'https://www.freeiconspng.com/uploads/potion-icon-png-14.png';
            $playerStatsDiv.appendChild($potion);

            const $skeletonStatsDiv = document.createElement('div');
            $skeletonStatsDiv.setAttribute('id', 'skeletonStatsDiv');
            $skeletonStatsDiv.classList.add('hide');
            $dungeonCrawler.appendChild($skeletonStatsDiv);
            const $skeletonHP = document.createElement('p');
            $skeletonHP.innerHTML = `Skeleton's HP: ${this.skeleton.hp}/10`;
            $skeletonStatsDiv.appendChild($skeletonHP);
          },

          drawControls() {
            const ArrowArr = [
              '<i class="fas fa-arrow-up"></i>',
              '<i class="fas fa-arrow-right"></i>',
              '<i class="fas fa-arrow-left"></i>',
              '<i class="fas fa-arrow-down"></i>',
            ];

            const $dungeonCrawlerControls = document.getElementById('dungeonCrawlerControls');

            const $controlsDiv = document.createElement('div');
            $controlsDiv.setAttribute('id', 'controlsDiv');
            $dungeonCrawlerControls.appendChild($controlsDiv);

            const directions = ['up', 'right', 'left', 'down',];

            for (var i = 0; i < ArrowArr.length; i++) {
              const $moveArrow = document.createElement('button');
              $moveArrow.classList.add('moveArrow');
              $moveArrow.setAttribute('id', `move_${directions[i]}`);
              $moveArrow.innerHTML = ArrowArr[i];
              $controlsDiv.appendChild($moveArrow);
              $moveArrow.addEventListener('click', this.movePlayer);
            }

            const $messageDiv = document.createElement('div');
            $messageDiv.innerHTML = 'To win the game defeat the enemy';
            $messageDiv.setAttribute('id', 'messageDiv');
            $dungeonCrawlerControls.appendChild($messageDiv);
          },

          movePlayer(event) {
            if (event.target.tagName == 'I') {
              var $moveArrow = event.target.parentElement;
            } else {
              var $moveArrow = event.target;
            }
            const direction = $moveArrow.id.split('_')[1];
            const $messageDiv = document.getElementById('messageDiv');

            switch (direction) {
              case 'up':
                if (y - 1 < 0) {
                  $messageDiv.innerHTML = 'You can\'t go there';
                } else {
                  y--;
                  dungeonCrawlerGame.map[y][x].explored = true;
                  dungeonCrawlerGame.drawMap();
                  if (!dungeonCrawlerGame.map[y][x].content) {
                    $messageDiv.innerHTML = 'This room is empty';
                  } else {
                    dungeonCrawlerGame.interactWithContent();
                  }
                }

                if (dungeonCrawlerGame.map[y][x].type == 'wall') {
                  $messageDiv.innerHTML = 'You\'ve hit a wall';
                  y++;
                  dungeonCrawlerGame.drawMap();
                }
                break;
              case 'down':
                if (y + 1 > 2) {
                  $messageDiv.innerHTML = 'You can\'t go there';
                } else {
                  y++;
                  dungeonCrawlerGame.map[y][x].explored = true;
                  dungeonCrawlerGame.drawMap();
                  if (!dungeonCrawlerGame.map[y][x].content) {
                    $messageDiv.innerHTML = 'This room is empty';
                  } else {
                    dungeonCrawlerGame.interactWithContent();
                  }
                }

                if (dungeonCrawlerGame.map[y][x].type == 'wall') {
                  $messageDiv.innerHTML = 'You\'ve hit a wall';
                  y--;
                  dungeonCrawlerGame.drawMap();
                }
                break;
              case 'left':
                if (x - 1 < 0) {
                  $messageDiv.innerHTML = 'You can\'t go there';
                } else {
                  x--;
                  dungeonCrawlerGame.map[y][x].explored = true;
                  dungeonCrawlerGame.drawMap();
                  if (!dungeonCrawlerGame.map[y][x].content) {
                    $messageDiv.innerHTML = 'This room is empty';
                  } else {
                    dungeonCrawlerGame.interactWithContent();
                  }
                }

                if (dungeonCrawlerGame.map[y][x].type == 'wall') {
                  $messageDiv.innerHTML = 'You\'ve hit a wall';
                  x++;
                  dungeonCrawlerGame.drawMap();
                }
                break;
              case 'right':
                if (x + 1 > 2) {
                  $messageDiv.innerHTML = 'You can\'t go there';
                } else {
                  x++;
                  dungeonCrawlerGame.map[y][x].explored = true;
                  dungeonCrawlerGame.drawMap();
                  if (!dungeonCrawlerGame.map[y][x].content) {
                    $messageDiv.innerHTML = 'This room is empty';
                  } else {
                    dungeonCrawlerGame.interactWithContent();
                  }
                }

                if (dungeonCrawlerGame.map[y][x].type == 'wall') {
                  $messageDiv.innerHTML = 'You\'ve hit a wall';
                  x--;
                  dungeonCrawlerGame.drawMap();
                }
                break;
            }
          },

          interactWithContent() {
            if (this.map[y][x].content == 'chest') {
              this.lootChest();
              this.map[y][x].content = null;
            } else if (this.map[y][x].content == 'skeleton') {
              this.fightSkeleton();
              this.map[y][x].content = null;
            }
          },

          lootChest() {
            const $messageDiv = document.getElementById('messageDiv');

            $messageDiv.innerHTML = 'In this room you\'ve found a chest!';
            const chestContent = this.determineChestContent();
            if (chestContent == 'potion') {
              this.player.hasPotion = true;
              $messageDiv.innerHTML += '<br>' + 'You\'ve found a healing potion';
            } else if (chestContent == 'sword') {
              this.player.attack += 2;
              $messageDiv.innerHTML += '<br>' + 'You\'ve found a good sword.' + '<br>' + 'You\'ve gained 2 attack';
            }
            this.drawMap();
          },

          determineChestContent() {
            const rndPosition = Math.floor(Math.random() * this.chestConentArr.length);
            const chestContent = this.chestConentArr[rndPosition];
            this.chestConentArr.splice(rndPosition, 1);
            return chestContent;
          },

          fightSkeleton() {
            const $messageDiv = document.getElementById('messageDiv');
            $messageDiv.innerHTML = 'In this room you\'ve found a menacing skeleton';

            const $skeletonStatsDiv = document.getElementById('skeletonStatsDiv');
            $skeletonStatsDiv.classList.add('show');
            $skeletonStatsDiv.classList.remove('hide');

            /*while (this.player.hp > 0 && this.skeleton.hp > 0) {
              this.playerBattleTurn();
              if (this.player.choseToRun) {
                this.player.choseToRun = false;
                return;
              }
              this.skeletonBattleTurn();
            }*/

            if (this.player.hp <= 0) {
              alert('Skeleton cuts off your head!');
            } else if (this.skeleton.hp <= 0) {
              alert('You\'ve defeated the evil skeleton!');
              this.player.hasWon = true;
            }
          },

          playerBattleTurn() {
            const action = prompt(`Your HP: ${this.player.hp}\nSkeleton's HP: ${this.skeleton.hp}\nTo attack enter a\nTo drink potion enter p\nTo run press r`);
            if (action == 'a') {
              alert('You swing your sword wildly');
              const isHit = this.isHit();
              if (isHit) {
                alert('You\'ve hit the skeleton');
                this.skeleton.hp -= this.player.attack;
              } else {
                alert('You\'ve missed the skeleton');
              }
            } else if (action == 'p') {
              if (this.player.hasPotion) {
                alert('The potion invigorates you. You\'ve gained 3 HP')
                this.player.hp += 3;
                if (this.player.hp > 10) {
                  this.player.hp = 10;
                }
                this.player.hasPotion = false;
              } else {
                alert('You have no potion to drink');
              }
            } else if (action == 'r') {
              alert('You\'ve chosen to run');
              x--;
              this.player.choseToRun = true;
              return;
            } else {
              alert('You\'ve lost your wits and do nothing');
            }
          },

          skeletonBattleTurn() {
            alert('Skeleton attacks you!');
            const isHit = this.isHit();
            if (isHit) {
              alert('It hits you');
              this.player.hp -= this.skeleton.attack;
            } else {
              alert('It misses');
            }
          },

          isHit() {
            return Math.random() >= 0.3;
          },

          turn() {
            alert('To win the game defeat the enemy');
            while (true) {
              this.drawMap();
              this.movePlayer();
              this.interactWithContent();
              if (this.player.hasWon || this.player.hp <= 0) {
                break;
              }
              toQuit = prompt('To quit the game press q');
              if (toQuit == 'q') {
                return;
              }
            }

            this.endGame();
          },

          endGame() {
            if (this.player.hasWon) {
              alert('You\'ve won the game!');
            } else {
              alert('You\'ve lost the game and died');
            }
          }
        }

        // Destructuring
        let { player: {position: {x}} } = dungeonCrawlerGame;
        let { player: {position: {y}} } = dungeonCrawlerGame;

        dungeonCrawlerGame.drawMap();
        dungeonCrawlerGame.drawControls();

        // Exercise 02
        const chessBoard = {
          width: 8,
          height: 8,
          letterArr: ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O', 'P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z'],

          // Сделал шахматную доску с динамически задаваемым размером
          drawChessBoard() {
            // Создаем родительский элемент и задаем ему динамическую ширину
            const $chessBoard = document.getElementById('chessBoard');
            $chessBoard.innerHTML = '';
            $chessBoard.style.width = `${this.width + 2}02px`;

            // Пробегаемся по строками
            for (var i = 0; i < (this.height + 2); i++) {
              // Пробегаемся по столбцам
              for (var j = 0; j < (this.width + 2); j++) {
                // Создаем дочерний элемент и присваиваем ему класс
                const $chessBoardCell = document.createElement('div');
                $chessBoardCell.classList.add('chessBoardCell');
                // Если первая или последняя строка, то присваиваем ячейкам буквы (но не в первом или последнем столбце)
                if (i === 0 || i === (this.height + 1)) {
                  if (!(j === 0) && !(j === (this.width + 1))) {
                    $chessBoardCell.innerHTML = this.letterArr[j - 1];
                  }
                  // Если первая строка, то поворачиваем буквы
                  if (i === 0) {
                    $chessBoardCell.classList.add('rotate');
                  }
                // Если четная строка
                } else if (i % 2 === 0) {
                  // Если первый и последний столбец, то присваиваем ячейкам цифры (но не в первой или последней строке)
                  if (j === 0 || j === (this.width + 1)) {
                    if (!(i === 0) && !(i === (this.height + 1))) {
                      $chessBoardCell.innerHTML = this.height + 1 - i;
                    }
                    // Если последний столбец, то поворачиваем цифры
                    if (j === (this.width + 1)) {
                      $chessBoardCell.classList.add('rotate');
                    }
                  // Если строка нечетная, то присваиваем один цвет, если четная - другой
                  } else if (!(j % 2 === 0)) {
                    $chessBoardCell.classList.add('black');
                  } else if (j % 2 === 0) {
                    $chessBoardCell.classList.add('beige');
                  }
                // Если нечетная строка (здесь тоже самое, только присвоение цвета в обратном порядке)
                } else if (!(i % 2 === 0)) {
                  if (j === 0 || j === (this.width + 1)) {
                    if (!(i === 0) && !(i === (this.height + 1))) {
                      $chessBoardCell.innerHTML = this.height + 1 - i;
                    }
                    if (j === (this.width + 1)) {
                      $chessBoardCell.classList.add('rotate');
                    }
                  } else if (!(j % 2 === 0)) {
                    $chessBoardCell.classList.add('beige');
                  } else if (j % 2 === 0) {
                    $chessBoardCell.classList.add('black');
                  }
                }
                $chessBoard.appendChild($chessBoardCell);
                // Проверяем, подходящая ли ячейка для фигуры
                if (this.isPlaceForPiece(i, j)) {
                  const $chessPiece = document.createElement('img');
                  // Если первая или последняя строка доски
                  if (i == 1 || i == this.height) {
                    // Размещаем фигуры в зависимости от столбца
                    switch (j) {
                      case 1:
                      case 8:
                        if (i == 1) {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/a/a0/Chess_rdt60.png';
                        } else {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/5/5c/Chess_rlt60.png';
                        }
                        break;
                      case 2:
                      case 7:
                        if (i == 1) {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/f/f1/Chess_ndt60.png';
                        } else {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/2/28/Chess_nlt60.png';
                        }
                        break;
                      case 3:
                      case 6:
                        if (i == 1) {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/8/81/Chess_bdt60.png';
                        } else {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/9/9b/Chess_blt60.png';
                        }
                        break;
                      case 4:
                        if (i == 1) {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/a/af/Chess_qdt60.png';
                        } else {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/4/49/Chess_qlt60.png';
                        }
                        break;
                      case 5:
                        if (i == 1) {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/e/e3/Chess_kdt60.png';
                        } else {
                          $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/3/3b/Chess_klt60.png';
                        }
                        break;
                    }
                  } else {
                    if (i == 2) {
                      $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/c/cd/Chess_pdt60.png';
                    } else {
                      $chessPiece.src = 'https://upload.wikimedia.org/wikipedia/commons/0/04/Chess_plt60.png';
                    }
                  }
                  $chessBoardCell.appendChild($chessPiece);
                }
              }
            }
          },

          // Функция проверяет, находится ли ячейка в первых двух или последних двух строках самой доски (не включая поля)
          isPlaceForPiece(i, j) {
            if ((this.width == 8 && this.height > 3) && (i == 1 || i == 2 || i == this.height || i == this.height - 1) && (j != 0 && j != this.width + 1)) {
              return true;
            } else {
              return false;
            }
          },

          drawChessBoardControls() {
            const $chessBoardControls = document.getElementById('chessBoardControls')

            const $chessBoardControlsForm = document.createElement('form');
            $chessBoardControls.appendChild($chessBoardControlsForm);

            const $labelForHeight = document.createElement('label');
            $labelForHeight.innerHTML = 'Set height';
            $chessBoardControlsForm.appendChild($labelForHeight);
            const $inputForHeight = document.createElement('input');
            $inputForHeight.setAttribute('id', 'inputForHeight');
            $inputForHeight.setAttribute('type', 'number');
            $labelForHeight.appendChild($inputForHeight);

            const $labelForWidth = document.createElement('label');
            $labelForWidth.innerHTML = 'Set width';
            $chessBoardControlsForm.appendChild($labelForWidth);
            const $inputForWidth = document.createElement('input');
            $inputForWidth.setAttribute('id', 'inputForWidth');
            $inputForWidth.setAttribute('type', 'number');
            $labelForWidth.appendChild($inputForWidth);

            const $generateChessBoard = document.createElement('button');
            $generateChessBoard.innerHTML = 'Generate Chessboard';
            $generateChessBoard.setAttribute('id', 'generateChessBoard');
            $chessBoardControlsForm.appendChild($generateChessBoard);
            $generateChessBoard.addEventListener('click', this.generateChessBoard);
          },

          generateChessBoard(event) {
            event.preventDefault();
            const width = +document.getElementById('inputForWidth').value;
            const height = +document.getElementById('inputForHeight').value;
            if (width < 1 || width > 12 || height < 1 || height > 12) {
              alert('Width and height must be between 1 and 12');
            } else {
              chessBoard.width = width;
              chessBoard.height = height;
              chessBoard.drawChessBoard();
            }
          }
        };

        chessBoard.drawChessBoard();
        chessBoard.drawChessBoardControls();

        // Exercise 03
        const ticTacToe = {
          grid: [
            [
              null, null, null
            ],
            [
              null, null, null
            ],
            [
              null, null, null
            ],
          ],
          playerOneTurn: true,
          gameEnded: false,

          drawGrid() {
            const $ticTacToe = document.getElementById('ticTacToe');
            $ticTacToe.innerHTML = '';

            for (var i = 0; i < this.grid.length; i++) {
              for (var j = 0; j < this.grid[i].length; j++) {
                const $gridCell = document.createElement('div');
                $gridCell.classList.add('gridCell');
                $gridCell.setAttribute('id', `gridCell_${i}${j}`);

                if (i == 0) {
                  $gridCell.style.borderTop = 'none';
                } else if (i == 2) {
                  $gridCell.style.borderBottom = 'none';
                }

                if (j == 0) {
                  $gridCell.style.borderLeft = 'none';
                } else if (j == 2) {
                  $gridCell.style.borderRight = 'none';
                }

                $gridCell.addEventListener('click', this.checkOff);
                $ticTacToe.appendChild($gridCell);
              }
            }

            this.drawTicTacToeButton();
            this.drawPlayerTurnDiv();
          },

          drawTicTacToeButton() {
            const $ticTacToe = document.getElementById('ticTacToe');
            const $clearButton = document.createElement('button');
            $clearButton.innerHTML = 'Clear';
            $clearButton.setAttribute('id', 'clearButton');
            $clearButton.addEventListener('click', this.clearTicTacToe);
            $ticTacToe.appendChild($clearButton);
          },

          clearTicTacToe(event) {
            ticTacToe.drawGrid();
            for (var i = 0; i < ticTacToe.grid.length; i++) {
              for (var j = 0; j < ticTacToe.grid[i].length; j++) {
                ticTacToe.grid[i][j] = null;
              }
            }
            ticTacToe.playerOneTurn = true;
            ticTacToe.gameEnded = false;
            const $playerTurnDiv = document.getElementById('playerTurnDiv');
            $playerTurnDiv.innerHTML = `Player ${ticTacToe.playerOneTurn ? '1' : '2'} turn (${ticTacToe.playerOneTurn ? 'X' : 'O'}s)`;
          },

          drawPlayerTurnDiv() {
            const $ticTacToe = document.getElementById('ticTacToe');
            const $playerTurnDiv = document.createElement('div');
            $playerTurnDiv.innerHTML = `Player ${this.playerOneTurn ? '1' : '2'} turn (${this.playerOneTurn ? 'X' : 'O'}s)`;
            $playerTurnDiv.setAttribute('id', 'playerTurnDiv');
            $ticTacToe.appendChild($playerTurnDiv);
          },

          checkOff(event) {
            const idNumbers = event.target.id.split('_')[1].split('');

            if (!ticTacToe.grid[idNumbers[0]][idNumbers[1]]) {
              if (ticTacToe.playerOneTurn) {
                ticTacToe.grid[idNumbers[0]][idNumbers[1]] = 'X';
                event.target.innerHTML = 'X';
                ticTacToe.playerOneTurn = false;
              } else {
                ticTacToe.grid[idNumbers[0]][idNumbers[1]] = 'O';
                event.target.innerHTML = 'O';
                ticTacToe.playerOneTurn = true;
              }

              const $playerTurnDiv = document.getElementById('playerTurnDiv');
              $playerTurnDiv.innerHTML = `Player ${ticTacToe.playerOneTurn ? '1' : '2'} turn (${ticTacToe.playerOneTurn ? 'X' : 'O'}s)`;
              ticTacToe.checkForWin();
            }
          },

          checkForWin() {
            const $playerTurnDiv = document.getElementById('playerTurnDiv');
            const verticalRows = this.transposeArray(this.grid);
            const diagonalRows = [[], [],];
            diagonalRows[0] = [this.grid[0][0], this.grid[1][1], this.grid[2][2]];
            diagonalRows[1] = [this.grid[0][2], this.grid[1][1], this.grid[2][0]];

            if (this.grid[0].every(this.isCrosses) || this.grid[1].every(this.isCrosses) || this.grid[2].every(this.isCrosses)) {
              $playerTurnDiv.innerHTML = 'Player 1 has Won';
              this.gameEnded = true;
            } else if (this.grid[0].every(this.isOughts) || this.grid[1].every(this.isOughts) || this.grid[2].every(this.isOughts)) {
              $playerTurnDiv.innerHTML = 'Player 2 has Won';
              this.gameEnded = true;
            } else if (verticalRows[0].every(this.isCrosses) || verticalRows[1].every(this.isCrosses) || verticalRows[2].every(this.isCrosses)) {
              $playerTurnDiv.innerHTML = 'Player 1 has Won';
              this.gameEnded = true;
            } else if (verticalRows[0].every(this.isOughts) || verticalRows[1].every(this.isOughts) || verticalRows[2].every(this.isOughts)) {
              $playerTurnDiv.innerHTML = 'Player 2 has Won';
              this.gameEnded = true;
            } else if (diagonalRows[0].every(this.isCrosses) || diagonalRows[1].every(this.isCrosses)) {
              $playerTurnDiv.innerHTML = 'Player 1 has Won';
              this.gameEnded = true;
            } else if (diagonalRows[0].every(this.isOughts) || diagonalRows[1].every(this.isOughts)) {
              $playerTurnDiv.innerHTML = 'Player 2 has Won';
              this.gameEnded = true;
            } else if (!this.grid.flat().includes(null)) {
              $playerTurnDiv.innerHTML = 'The game is a draw';
              this.gameEnded = true;
            }

            if (this.gameEnded) {
              const $gridCells = document.getElementsByClassName('gridCell');
              for (var i = 0; i < $gridCells.length; i++) {
                $gridCells[i].removeEventListener('click', this.checkOff);
              }
            }
          },

          isCrosses(cur) {
            return cur == 'X';
          },

          isOughts(cur) {
            return cur == 'O';
          },

          transposeArray(arr) {
            const newArr = [];
            for (var i = 0; i < arr.length; i++) {
              newArr.push([]);
            }

            for (var i = 0; i < arr.length; i++) {
              for (var j = 0; j < arr.length; j++) {
                newArr[j].push(this.grid[i][j]);
              }
            }

            return newArr;
          },
        };

        ticTacToe.drawGrid();
      }

      window.onload = wrapperFunc;
    </script>
  </head>
  <body>
    <h1>Exercises 1 & 2</h1>
    <div id='basket'></div>
    <div class="modalWrapper">
      <div class='modalWindow'>
        <span class="close">&times;</span>
        <i class="fas fa-arrow-left" id='modalArrowLeft'></i>
        <i class="fas fa-arrow-right" id='modalArrowRight'></i>
      </div>
    </div>
    <div id='basketControls'></div>
    <h1>Exercise 01</h1>
    <div id='dungeonCrawler'></div>
    <div id='dungeonCrawlerControls'></div>
    <h1>Exercise 02</h1>
    <div id='chessBoard'></div>
    <div id='chessBoardControls'></div>
    <h1>Exercise 03</h1>
    <div id='ticTacToe'></div>
  </body>
</html>
